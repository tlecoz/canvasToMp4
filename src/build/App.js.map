{"version":3,"file":"App.js","sourceRoot":"","sources":["../App.ts"],"names":[],"mappings":"AAAA;IAkBE;QAVQ,YAAO,GAAW,KAAK,CAAC;QACxB,cAAS,GAAW,KAAK,CAAC;QAC1B,YAAO,GAAU,CAAC,CAAC,CAAC;QAU1B,IAAI,CAAC,MAAM,GAAG,IAAI,aAAa,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;IACjD,CAAC;IAIM,WAAW,CAAC,MAA2D,EAAC,gBAAuB,EAAC,MAAW,EAAE,EAAC,oBAAyB,CAAC;QAC7I,IAAI,CAAC,QAAQ,GAAG,gBAAgB,CAAC;QAEjC,IAAI,CAAC,aAAa,GAAG,MAAM,CAAC;QAC5B,IAAI,CAAC,UAAU,GAAG,MAAM,CAAC,GAAG,YAAY,wBAAwB,CAAC;QACjE,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;QACvB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;QACpB,IAAI,CAAC,OAAO,GAAG,CAAC,CAAC;QACjB,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC;QACtB,IAAG,iBAAiB,IAAI,CAAC;YAAE,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,iBAAiB,GAAG,GAAG,CAAC,CAAC;QAE7E,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,MAAM,CAAC,KAAK,EAAC,MAAM,CAAC,GAAG,CAAC,MAAM,CAAC,MAAM,EAAC,GAAG,CAAC,CAAC;IAC1E,CAAC;IAEM,SAAS;QACd,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;QACrB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;QACtB,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;IAEpB,CAAC;IAEM,MAAM;QACX,IAAG,IAAI,CAAC,SAAS;YAAE,OAAO;QAE1B,IAAG,IAAI,CAAC,aAAa,IAAI,IAAI,CAAC,OAAO,EAAC;YAEpC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC;YACpC,IAAG,IAAI,CAAC,UAAU;gBAAE,IAAI,CAAC,MAAM,CAAC,eAAe,CAAC,IAAI,CAAC,aAAa,CAAC,GAA+B,CAAC,CAAC;;gBAC/F,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,IAAI,CAAC,aAAa,CAAC,GAA4B,CAAC,CAAC;YAE/E,IAAI,CAAC,YAAY,EAAE,CAAC;YACpB,IAAG,CAAC,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,OAAO,IAAI,CAAC,IAAI,IAAI,CAAC,YAAY,IAAI,IAAI,CAAC,OAAO,EAAC;gBAC1E,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;gBACtB,IAAI,CAAC,SAAS,EAAE,CAAC;aAClB;YACD,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC;SACzB;IACH,CAAC;CAGF","sourcesContent":["class App  {\r\n\r\n\r\n\r\n  private ffmpeg:FFMpegManager;\r\n  private captureTarget:{ctx:CanvasRenderingContext2D|WebGLRenderingContext};\r\n\r\n\r\n  private started:boolean = false;\r\n  private completed:boolean = false;\r\n  private nbFrame:number = -1;\r\n  private currentFrame:number;\r\n  private isCanvas2D:boolean;\r\n  private drawFunc:string;\r\n\r\n  public onRecordCompleted:Function;\r\n  public onFileCreated:Function;\r\n\r\n  constructor(){\r\n\r\n    this.ffmpeg = new FFMpegManager(document.body);\r\n  }\r\n\r\n\r\n\r\n  public recordStart(target:{ctx:CanvasRenderingContext2D|WebGLRenderingContext},drawFunctionName:string,fps:number=60,durationInSeconds:number=0):void{\r\n    this.drawFunc = drawFunctionName;\r\n\r\n    this.captureTarget = target;\r\n    this.isCanvas2D = target.ctx instanceof CanvasRenderingContext2D;\r\n    this.completed = false;\r\n    this.started = true;\r\n    this.nbFrame = 0;\r\n    this.currentFrame = 0;\r\n    if(durationInSeconds >= 0) this.nbFrame = Math.ceil(durationInSeconds * fps);\r\n\r\n    this.ffmpeg.start(target.ctx.canvas.width,target.ctx.canvas.height,fps);\r\n  }\r\n\r\n  public recordEnd():void{\r\n    this.started = false;\r\n    this.completed = true;\r\n    this.ffmpeg.end();\r\n\r\n  }\r\n\r\n  public update():boolean{\r\n    if(this.completed) return;\r\n\r\n    if(this.captureTarget && this.started){\r\n\r\n      this.captureTarget[this.drawFunc]();\r\n      if(this.isCanvas2D) this.ffmpeg.canvas2dToVideo(this.captureTarget.ctx as CanvasRenderingContext2D);\r\n      else this.ffmpeg.webglToVideo(this.captureTarget.ctx as WebGLRenderingContext);\r\n\r\n      this.currentFrame++;\r\n      if(!this.completed && this.nbFrame != 0 && this.currentFrame >= this.nbFrame){\r\n         this.completed = true;\r\n         this.recordEnd();\r\n       }\r\n       return !this.completed;\r\n    }\r\n  }\r\n\r\n\r\n}\r\n"]}